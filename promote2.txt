برومبت: “توحيد ترقيم الصفحات + اقتناص الناشر بدقة” (نطاق محدود)
نطاق التنفيذ (لا تغيّر غير المطلوب)

لا تلمس: العنوان/المؤلف/الفهرس/الوصف/الأجزاء… إلخ.

نفّذ فقط:

حساب عدد الصفحات من واجهة القراءة وحفظ ترقيمين: داخلي + مطبوع، مع خرائط تنقّل صحيحة.

استخراج الناشر كاملًا: من بعد كلمة “الناشر:” وحتى نهاية السطر، حتى لو وُجدت كلمة “توزيع” قبلها.

(1) الترقيم الداخلي والمطبوع + عدد الصفحات
ما المطلوب؟

أبعد اعتماد “عدد الصفحات” عن بطاقة الكتاب تمامًا؛ احسبه من واجهة القراءة:

الداخلي (N): من صفحة /book/{id}/1 التقط رابط «>>» في شريط الصفحات “ص:” واستخرج منه أكبر N (آخر صفحة داخلية). إن غاب «>>»، استخرج أكبر N من كل الروابط التي على شكل /book/{id}/N في نفس الصفحة. (الـ fragment #… ليس جزءًا من الطلب ولا يصل للخادم، تجاهله). 
MDN Web Docs

المطبوع (ص): إن كان الكتاب “موافق للمطبوع”، افتح آخر صفحة داخلية (/book/{id}/N_max) واقرأ رقم ص من <title> بصيغة ص 711، مع دعم الأرقام العربية-الهندية U+0660..U+0669. 
ويكيبيديا
Compart

حفظ العدّ في جدول الكتب (books):

page_count_internal = عدد الصفحات الداخلي N.

page_count_printed = آخر رقم مطبوع إن توافر، وإلا NULL.

حفظ الترقيمين لكل صفحة (إن لم يكن مضافًا سابقًا):

في pages:

internal_index = N (من المسار).

page_number = المطبوع (ص) إن وُجد، وإلا N.

خريطة تنقّل مطبوع→داخلي:

ابنِ خريطة من N → ص أثناء القراءة (من <title>)، ثم وفّر دالة عكسية للذهاب إلى N الأدنى الذي يطابق ص المطلوب.

مثال: إذا أدخل المستخدم “ص 5” → اقفز إلى N=1 (إن كانت ص5 هي أول صفحة مطبوعة للكتاب/الجزء).

تنظيف نص <title>:

استخدم Regex مرن:
[صس]\s*[:：]?\s*([0-9\u0660-\u0669]+) مع تحويل الأرقام الشرقية إلى غربية قبل int. 
ويكيبيديا

لو احتجت تنظيفًا عامًا للنص من DOM، استخدم get_text(separator, strip=True) (BS4). 
crummy.com
tutorialspoint.com

معايير القبول

لا تعتمد أبدًا على بطاقة الكتاب في page_count.

page_count_internal يساوي آخر N حقيقي.

عند “موافق للمطبوع”: page_count_printed يساوي آخر ص من <title>.

إدخال “ص 5” يوجّه دائمًا لأول N يقابلها.

تجاهل أي دلالة من #pN لأنها fragment عميل-فقط. 
MDN Web Docs

(2) استخراج الناشر كاملًا “من بعد: الناشر: … حتى نهاية السطر”
ما المطلوب؟

أحيانًا يظهر “توزيع …” قبل “الناشر:”. المطلوب أخذ كل ما بعد “الناشر:” مباشرة وحتى نهاية السطر، بما فيه الفواصل العربية ، والأماكن، بلا تقطيع.

أمثلة شكل السطر (كلها صالحة):

الناشر: المراقبة الثقافية، إدارة المساجد، محافظة العاصمة، الكويت

الناشر: دار فلان للنشر والتوزيع، القاهرة

الالتقاط:

اعمل على نص السطر الذي يحوي “الناشر:”، واقتطع المجموعة الأولى فقط بعد النقطتين حتى نهاية السطر (قبل أول سطر جديد).

Regex إرشادي (لا تغيّر المنطق العام للمشروع):
الناشر\s*[:：]\s*([^\n]+)

لا تقطع عند الفواصل العربية (U+060C “،”) — أدرجها ضمن النتيجة. 
Compart

في حال تعدد الصيغ (“دار النشر: …”، “النشر: …”)، طبّق نفس القاعدة لكن أعطِ أولوية لـ “الناشر:” عند التزاحم، ثم “دار النشر:”.

لا تُسقِط كلمات مثل “للنشر والتوزيع” إن جاءت بعد “الناشر:”؛ احفظ السلسلة كاملة حتى نهاية السطر.

معايير القبول

الحقل publisher.name يساوي النص الكامل بعد “الناشر:” وحتى نهاية السطر، دون بتر للأماكن أو العبارات المركبة.

لا تؤثّر كلمة “توزيع” إن كانت قبل “الناشر:”.

أمثلة تحقق:
“الناشر: المراقبة الثقافية، إدارة المساجد، محافظة العاصمة، الكويت” → الحفظ يكون النص كاملًا كما هو.

ملاحظات تنفيذ عامة

معالجة الأرقام العربية-الهندية: دعم تحويل U+0660..U+0669 إلى 0..9 قبل التحويل العددي. (راجع مرجع Unicode للأرقام العربية-الهندية). 
ويكيبيديا
Compart

تنظيف النصوص من DOM عند الحاجة باستخدام get_text(separator, strip=True) (BeautifulSoup). 
crummy.com

تذكير: مقطع الـ URL بعد # لا يصل للخادم ولا يُستخدم كمرجع للصفحات. 
MDN Web Docs

(لو احتجت ترقية/إضافة أعمدة): تنفيذها عبر Laravel Migrations (إنشاء/تعديل أعمدة وفهارس فقط). 
laravel.com

لا تغيّر غير ذلك

لا تعدّل المنطق الحالي للعناوين/المؤلفين/الفهرس/الوصف/الأجزاء… إلخ.

أي أسطر أو وظائف جديدة تُضاف داخل نطاق هذا البرومبت فقط.